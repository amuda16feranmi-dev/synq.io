<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Contacts</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #ece5dd;
}

.header {
  background: #075e54;
  color: white;
  padding: 15px;
  text-align: center;
  font-size: 18px;
}

.contact {
  background: white;
  padding: 15px;
  margin: 8px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  cursor: pointer;
}

.avatar {
  width: 40px;
  height: 40px;
  background: #25d366;
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 12px;
  font-weight: bold;
}

.username {
  font-size: 16px;
}

.logout {
  background: #dc3545;
  color: white;
  border: none;
  width: 100%;
  padding: 12px;
  font-size: 16px;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="header">Contacts</div>

<div id="contactsList">Loading contacts...</div>

<button class="logout" onclick="logout()">Logout</button>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCSo3we0rPWhMSgDz-gghQUcv5DxaM7cCs",
  authDomain: "synq-1a6fe.firebaseapp.com",
  projectId: "synq-1a6fe",
  storageBucket: "synq-1a6fe.firebasestorage.app",
  messagingSenderId: "991435331026",
  appId: "1:991435331026:web:94022c39f22a4f7ee9240b"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();
let currentUserId = "";

/* PROTECT PAGE */
auth.onAuthStateChanged(user => {
  if (!user) {
    window.location.href = "login.html";
  } else {
    currentUserId = user.uid;
    loadContacts();
  }
});

/* LOAD CONTACTS */
function loadContacts() {
  const list = document.getElementById("contactsList");
  list.innerHTML = "";

  db.collection("users").get().then(snapshot => {
    snapshot.forEach(doc => {
      if (doc.id !== currentUserId) {
        const user = doc.data();

        const div = document.createElement("div");
        div.className = "contact";
        div.innerHTML = `
          <div class="avatar">${user.username.charAt(0).toUpperCase()}</div>
          <div class="username">${user.username}</div>
        `;

        // ðŸ‘‰ CLICK â†’ OPEN CHAT
        div.onclick = () => {
          window.location.href = "chat.html?uid=" + doc.id;
        };

        list.appendChild(div);
      }
    });

    if (list.innerHTML === "") {
      list.innerHTML = "No contacts found";
    }
  });
}

/* LOGOUT */
function logout() {
  auth.signOut().then(() => {
    window.location.href = "login.html";
  });
}
</script>

</body>
</html>